<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>THÉÂTRES YA BISO</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
<style>
    :root {
        --primary-dark: #141414;
        --secondary-dark: #1E1E1E;
        --text-light: #E5E5E5;
        --text-muted: #888888;
        --accent-red: #E50914;
        --shadow-light: rgba(0, 0, 0, 0.2);
        --shadow-medium: rgba(0, 0, 0, 0.5);
    }

    body {
        font-family: 'Poppins', sans-serif;
        background-color: var(--primary-dark);
        color: var(--text-light);
        margin: 0;
        padding: 0;
        line-height: 1.6;
        padding-bottom: 70px; /* Ajout pour la nav du bas */
    }

    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 20px 0;
        position: sticky;
        top: 0;
        z-index: 1000;
        background-color: var(--primary-dark);
    }

    .header h1 {
        margin: 0;
        font-size: 1.5em;
        letter-spacing: 1px;
    }

    .header .user-profile {
        font-size: 1.5em;
        color: var(--text-light);
    }
    
    .header .user-profile i {
        cursor: pointer;
        margin-left: 15px;
    }

    .categories-nav {
        display: flex;
        justify-content: flex-start;
        padding: 10px 20px;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        -ms-overflow-style: none;
    }

    .categories-nav::-webkit-scrollbar {
        display: none;
    }

    .categories-nav button {
        background: none;
        border: none;
        color: var(--text-muted);
        font-weight: 600;
        font-size: 1em;
        padding: 10px 15px;
        cursor: pointer;
        transition: color 0.3s ease;
        white-space: nowrap;
    }

    .categories-nav button.active {
        color: var(--text-light);
    }

    .categories-nav button:hover {
        color: var(--text-light);
    }

    .hero-section {
        position: relative;
        height: 400px;
        display: flex;
        align-items: flex-end;
        margin: 0 20px 20px;
        overflow: hidden;
        border-radius: 10px;
    }

    .hero-carousel {
        display: flex;
        width: 100%;
        height: 100%;
        transition: transform 0.5s ease-in-out;
    }

    .hero-item {
        min-width: 100%;
        position: relative;
    }

    .hero-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        position: absolute;
        top: 0;
        left: 0;
    }

    .hero-content {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        padding: 20px;
        background: linear-gradient(to top, rgba(0, 0, 0, 0.9), transparent);
    }

    .hero-content h2 {
        margin: 0 0 10px;
        font-size: 2.5em;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
    }

    .hero-buttons {
        display: flex;
        gap: 15px;
    }

    .hero-buttons button {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        font-size: 1em;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s ease;
    }

    .hero-buttons button:hover {
        transform: scale(1.05);
    }

    .hero-buttons .play-btn {
        background-color: var(--text-light);
        color: var(--primary-dark);
    }

    .hero-buttons .add-btn {
        background-color: var(--text-muted);
        color: var(--text-light);
    }

    .content-row {
        padding: 0 0 20px 20px;
    }

    .content-row h2 {
        font-size: 1.4em;
        margin-bottom: 15px;
    }

    /* Accueil : ligne horizontale */
    .content-row.home .videos-list {
        display: flex;
        overflow-x: scroll;
        gap: 15px;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        -ms-overflow-style: none;
    }

    .content-row.home .videos-list::-webkit-scrollbar {
        display: none;
    }

    .home-video-card {
        width: 250px;
        height: 140.625px;
        background-color: var(--secondary-dark);
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 10px var(--shadow-light);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        cursor: pointer;
        flex-shrink: 0;
    }

    .home-video-card:hover {
        transform: scale(1.05);
        box-shadow: 0 8px 16px var(--shadow-medium);
    }

    /* Catégories : grille 3 colonnes ajustée */
    .content-row.category {
        padding-left: 20px;
        padding-right: 20px;
    }

    .content-row.category .videos-list {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        grid-gap: 10px;
    }
    
    .video-card-vertical {
        width: 100%;
        height: auto;
    }

    .video-card-vertical:hover {
        transform: scale(1.05);
        box-shadow: 0 8px 16px var(--shadow-medium);
    }

    .video-card {
        background-color: var(--secondary-dark);
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 10px var(--shadow-light);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        cursor: pointer;
        position: relative;
        padding-bottom: 10px;
    }

    .video-card img.video-thumbnail {
        width: 100%;
        height: auto;
        object-fit: cover;
        display: block;
        border-radius: 8px 8px 0 0;
    }

    .video-card .video-title {
        font-size: 0.8em;
        padding: 5px;
        color: var(--text-light);
        text-align: center;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    #video-player-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.95);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        animation: fadeIn 0.3s ease-out forwards;
        flex-direction: column;
    }

    #video-player-frame {
        width: 90%;
        max-width: 1000px;
        height: 70%;
        max-height: 600px;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }

    #video-player-frame iframe {
        width: 100%;
        height: 100%;
        border-radius: 10px;
    }

    #close-btn {
        position: absolute;
        top: 25px;
        right: 35px;
        color: var(--text-light);
        font-size: 45px;
        cursor: pointer;
        transition: transform 0.2s ease;
        text-shadow: 2px 2px 5px var(--shadow-medium);
    }

    #close-btn:hover {
        transform: rotate(90deg) scale(1.1);
    }
    
    #suggested-videos-container {
        width: 90%;
        max-width: 1000px;
        margin-top: 20px;
        max-height: 200px;
        overflow-y: auto;
    }

    #suggested-videos-container h3 {
        margin-bottom: 10px;
    }

    #suggested-videos-list {
        display: flex;
        gap: 10px;
        overflow-x: auto;
        padding-bottom: 10px;
        scrollbar-width: none;
        -ms-overflow-style: none;
    }

    #suggested-videos-list::-webkit-scrollbar {
        display: none;
    }

    .bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background-color: var(--secondary-dark);
        display: flex;
        justify-content: space-around;
        padding: 10px 0;
        border-top: 1px solid #333;
        z-index: 999;
    }

    .nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        color: var(--text-muted);
        text-decoration: none;
        font-size: 0.8em;
        transition: color 0.3s ease;
    }

    .nav-item i {
        font-size: 1.2em;
        margin-bottom: 5px;
    }

    .nav-item.active {
        color: var(--text-light);
    }
</style>
</head>
<body>

<header class="header">
    <h1>THÉÂTRES YA BISO<br /><small style="font-size:0.5em; color:var(--text-muted);">mboka_mj</small></h1>
    <div class="user-profile" aria-label="recherche et profil">
        <i class="fas fa-search" role="button" tabindex="0" aria-label="Recherche"></i>
        <i class="fas fa-user-circle" role="button" tabindex="0" aria-label="Profil utilisateur"></i>
    </div>
    <div id="search-container" style="display: none; position: absolute; top: 100%; left: 0; width: 100%; padding: 10px 20px; background-color: var(--secondary-dark); border-bottom: 1px solid #333; box-sizing: border-box;">
        <input type="text" id="search-input" placeholder="Rechercher des films, séries, musiques..." style="width: 100%; padding: 10px; border: none; border-radius: 5px; background-color: var(--primary-dark); color: var(--text-light);" />
    </div>
    <div id="profile-menu" style="display: none; position: absolute; top: 100%; right: 20px; background-color: var(--secondary-dark); border-radius: 5px; box-shadow: 0 4px 10px var(--shadow-medium); z-index: 1001;">
        <a href="#" class="profile-item" style="display: block; padding: 10px 20px; text-decoration: none; color: var(--text-light); border-bottom: 1px solid #333;">Gérer le profil</a>
        <a href="#" class="profile-item" style="display: block; padding: 10px 20px; text-decoration: none; color: var(--text-light);">Se déconnecter</a>
    </div>
</header>

<main>
    <section class="hero-section" aria-label="Carrousel vidéo tendance">
        <div class="hero-carousel"></div>
    </section>

    <nav class="categories-nav" role="navigation" aria-label="Navigation par catégories">
        <button onclick="loadCategory('Accueil')" class="active" aria-current="page">Accueil</button>
        <button onclick="loadCategory('Tendance')">Tendance</button>
        <button onclick="loadCategory('Gag')">Gag</button>
        <button onclick="loadCategory('Films')">Films Congolais</button>
        <button onclick="loadCategory('Musique')">Musique</button>
        <button onclick="loadMyList()">Ma liste</button>
    </nav>

    <section id="content-rows" aria-live="polite"></section>
</main>

<div id="video-player-container" role="dialog" aria-modal="true" aria-labelledby="video-title">
    <div id="video-player-frame">
        <iframe id="video-player" width="100%" height="auto" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen title="Lecteur vidéo"></iframe>
    </div>
    <span id="close-btn" role="button" tabindex="0" aria-label="Fermer la lecture vidéo">✖</span>
    <div id="suggested-videos-container">
        <h3>Vidéos suggérées</h3>
        <div id="suggested-videos-list" class="videos-list"></div>
    </div>
</div>

<nav class="bottom-nav" role="navigation" aria-label="Navigation inférieure">
    <a href="#" class="nav-item active" id="home-nav" aria-current="page">
        <i class="fas fa-home"></i>
        <span>Accueil</span>
    </a>
    <a href="#" class="nav-item" id="ranking-nav" tabindex="0">
        <i class="fas fa-trophy"></i>
        <span>Classement</span>
    </a>
    <a href="#" class="nav-item" id="news-nav" tabindex="0">
        <i class="fas fa-bell"></i>
        <span>Nouveautés</span>
    </a>
    <a href="#" class="nav-item" id="download-nav" tabindex="0">
        <i class="fas fa-download"></i>
        <span>Télécharger</span>
    </a>
</nav>

<script>
    const API_KEY = 'AIzaSyCsfwTS61H_NOb0U2aK2TC3LLnB4vnfTNM';

    const contentRowsContainer = document.getElementById('content-rows');
    const categoriesNavButtons = document.querySelectorAll('.categories-nav button');
    const videoPlayerContainer = document.getElementById('video-player-container');
    const videoPlayer = document.getElementById('video-player');
    const closeBtn = document.getElementById('close-btn');
    const heroCarousel = document.querySelector('.hero-carousel');
    const heroSection = document.querySelector('.hero-section');
    const suggestedVideosList = document.getElementById('suggested-videos-list');
    
    // Déclaration des nouveaux éléments
    const searchIcon = document.querySelector('.fas.fa-search');
    const userProfileIcon = document.querySelector('.fas.fa-user-circle');
    const searchContainer = document.getElementById('search-container');
    const searchInput = document.getElementById('search-input');
    const profileMenu = document.getElementById('profile-menu');
    
    // Déclaration des éléments de la nav inférieure
    const bottomNavItems = document.querySelectorAll('.bottom-nav .nav-item');
    const homeNavBtn = document.getElementById('home-nav');
    const rankingNavBtn = document.getElementById('ranking-nav');
    const newsNavBtn = document.getElementById('news-nav');
    const downloadNavBtn = document.getElementById('download-nav');

    const playlists = {
        'Tendance': 'PL_0_czPdB1wTMgJ6mr3mtUPSoTeTjUBdg',
        'Gag': 'PL_0_czPdB1wQC-n2pfKZPgv0Qw5M5cTnJ',
        'Films': 'PL_0_czPdB1wTgFfbOMYbCz5fX6gzFJjPq',
        'Musique': 'PL_0_czPdB1wRQvWg-2NFZebqSGbcCtmvW',
    };

    let allVideosCache = {};
    let carouselVideos = [];

    // Fonction pour récupérer toutes les vidéos d'une playlist en gérant la pagination
    async function fetchPlaylistItemsWithPagination(playlistId) {
        let allItems = [];
        let nextPageToken = null;

        try {
            do {
                const url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet,contentDetails&maxResults=50&playlistId=${playlistId}&key=${API_KEY}&pageToken=${nextPageToken || ''}`;
                const res = await fetch(url);
                
                if (!res.ok) {
                    const errorData = await res.json();
                    throw new Error(`Erreur API (${res.status}): ${errorData.error.message}`);
                }
                
                const data = await res.json();
                
                if (data.items) {
                    allItems = allItems.concat(data.items.filter(item => item.snippet && item.snippet.thumbnails));
                }
                
                nextPageToken = data.nextPageToken;
                
            } while (nextPageToken);

            return allItems;

        } catch (error) {
            console.error("Erreur lors de la récupération des vidéos:", error);
            contentRowsContainer.innerHTML = '<p style="text-align: center; margin-top: 50px;">Erreur lors du chargement des vidéos. Veuillez vérifier votre clé API ou connexion.</p>';
            return [];
        }
    }

    // Fonction principale modifiée pour utiliser la nouvelle fonction de pagination
    async function fetchAllVideos() {
        if (Object.keys(allVideosCache).length > 0) return allVideosCache;

        contentRowsContainer.innerHTML = '<div style="text-align: center; margin-top: 50px;"><i class="fas fa-spinner fa-spin"></i> Chargement des vidéos...</div>';
        
        const allPlaylists = Object.keys(playlists);
        try {
            for (const category of allPlaylists) {
                const playlistId = playlists[category];
                allVideosCache[category] = await fetchPlaylistItemsWithPagination(playlistId);
            }
            contentRowsContainer.innerHTML = '';
            return allVideosCache;
        } catch (error) {
            console.error("Erreur lors de la récupération des vidéos:", error);
            contentRowsContainer.innerHTML = '<p style="text-align: center; margin-top: 50px;">Erreur lors du chargement des vidéos. Veuillez vérifier votre clé API ou connexion.</p>';
            return {};
        }
    }

    function renderVideos(videos, title, isHome = false) {
        if (videos.length === 0) return;
        const rowSection = document.createElement('section');
        rowSection.className = 'content-row ' + (isHome ? 'home' : 'category');
        rowSection.innerHTML = `<h2>${title}</h2><div class="videos-list"></div>`;
        const videoList = rowSection.querySelector('.videos-list');

        videos.forEach(item => {
            const snippet = item.snippet;
            const videoId = snippet.resourceId.videoId;
            const card = document.createElement('div');
            card.className = `video-card ${isHome ? 'home-video-card' : 'video-card-vertical'}`;
            card.innerHTML = `
                <img src="${snippet.thumbnails.high.url}" alt="${snippet.title}" class="video-thumbnail" loading="lazy" />
                <div class="video-title">${snippet.title}</div>
            `;
            
            card.onclick = () => playVideo(videoId, item.id);
            videoList.appendChild(card);
        });

        contentRowsContainer.appendChild(rowSection);
    }

    function renderMyList(videos) {
        if (videos.length === 0) {
            contentRowsContainer.innerHTML = '<p style="text-align: center; margin-top: 50px;">Votre liste est vide. Ajoutez des vidéos pour les retrouver ici !</p>';
            return;
        }
        const rowSection = document.createElement('section');
        rowSection.className = 'content-row category';
        rowSection.innerHTML = `<h2>Ma liste</h2><div class="videos-list"></div>`;
        const videoList = rowSection.querySelector('.videos-list');

        videos.forEach(item => {
            const card = document.createElement('div');
            card.className = 'video-card video-card-vertical';
            card.innerHTML = `
                <img src="${item.thumbnailUrl}" alt="${item.videoTitle}" class="video-thumbnail" loading="lazy" />
                <div class="video-title">${item.videoTitle}</div>
            `;
            card.onclick = () => playVideo(item.videoId);
            videoList.appendChild(card);
        });

        contentRowsContainer.appendChild(rowSection);
    }

    async function loadHome() {
        const videosByCategories = await fetchAllVideos();
        if (Object.keys(videosByCategories).length === 0) return;
        contentRowsContainer.innerHTML = '';

        const categoriesToShow = ['Tendance', 'Gag', 'Films', 'Musique'];
        for (const category of categoriesToShow) {
            const videos = videosByCategories[category];
            if (videos && videos.length > 0) {
                renderVideos(videos.slice(0, 5), category, true); 
            }
        }
        
        const allVideosArray = [].concat(...Object.values(videosByCategories));
        const sortedVideos = allVideosArray.sort((a, b) => new Date(b.snippet.publishedAt) - new Date(a.snippet.publishedAt));
        if (sortedVideos.length > 0) {
            renderVideos(sortedVideos.slice(0, 5), "Récemment Ajoutés", true);
        }
        
        const comedyVideos = allVideosArray.filter(video => 
            video.snippet.title.toLowerCase().includes('gag') || 
            video.snippet.title.toLowerCase().includes('comédie') || 
            video.snippet.description.toLowerCase().includes('rire')
        );
        if (comedyVideos.length > 0) {
            renderVideos(comedyVideos.slice(0, 5), "Le meilleur de la comédie", true);
        }
    }

    async function loadCategory(categoryName) {
        categoriesNavButtons.forEach(button => {
            button.classList.remove('active');
            if (button.textContent.trim() === categoryName) button.classList.add('active');
        });
        contentRowsContainer.innerHTML = '';
        if (categoryName === 'Accueil') {
            await loadHome();
        } else {
            const videosByCategories = await fetchAllVideos();
            const videos = videosByCategories[categoryName];
            if (videos && videos.length > 0) {
                renderVideos(videos, categoryName);
            } else {
                contentRowsContainer.innerHTML = '<p style="text-align: center; margin-top: 50px;">Aucune vidéo trouvée pour cette catégorie.</p>';
            }
        }
    }

    function loadMyList() {
        categoriesNavButtons.forEach(button => button.classList.remove('active'));
        const myListButton = document.querySelector('.categories-nav button[onclick="loadMyList()"]');
        if (myListButton) myListButton.classList.add('active');
        contentRowsContainer.innerHTML = '';
        const myList = JSON.parse(localStorage.getItem('myList')) || [];
        renderMyList(myList);
    }
    
    function addToMyList(videoId, videoTitle, thumbnailUrl) {
        let myList = JSON.parse(localStorage.getItem('myList')) || [];
        const existingVideoIndex = myList.findIndex(item => item.videoId === videoId);

        if (existingVideoIndex > -1) {
            myList.splice(existingVideoIndex, 1);
            alert(`"${videoTitle}" a été retiré de votre liste.`);
        } else {
            myList.push({ videoId, videoTitle, thumbnailUrl });
            alert(`"${videoTitle}" a été ajouté à votre liste !`);
        }
        localStorage.setItem('myList', JSON.stringify(myList));
        console.log("Ma liste actuelle:", myList);
    }

    async function setupHeroCarousel() {
        const videosByCategories = await fetchAllVideos();
        const tendanceVideos = videosByCategories['Tendance'];
        carouselVideos = tendanceVideos ? tendanceVideos.slice(0, 5) : [];
        heroCarousel.innerHTML = '';
        if (carouselVideos.length === 0) {
            heroSection.style.display = 'none';
            return;
        } else {
            heroSection.style.display = 'flex';
        }

        carouselVideos.forEach(item => {
            const snippet = item.snippet;
            const videoId = snippet.resourceId.videoId;
            const heroItem = document.createElement('div');
            heroItem.className = 'hero-item';
            heroItem.innerHTML = `
                <img src="${snippet.thumbnails.maxres ? snippet.thumbnails.maxres.url : snippet.thumbnails.high.url}" alt="${snippet.title}" />
                <div class="hero-content">
                    <h2>${snippet.title}</h2>
                    <div class="hero-buttons">
                        <button class="play-btn" onclick="playVideo('${videoId}')"><i class="fas fa-play"></i> Lecture</button>
                        <button class="add-btn" onclick="addToMyList('${videoId}', '${snippet.title}', '${snippet.thumbnails.high.url}')" title="Ajouter à ma liste"><i class="fas fa-plus"></i> Ma liste</button>
                    </div>
                </div>
            `;
            heroCarousel.appendChild(heroItem);
        });

        let currentSlide = 0;
        const totalSlides = carouselVideos.length;

        const updateCarousel = () => {
            const offset = -currentSlide * heroSection.offsetWidth;
            heroCarousel.style.transform = `translateX(${offset}px)`;
        };

        setInterval(() => {
            currentSlide = (currentSlide + 1) % totalSlides;
            updateCarousel();
        }, 5000);

        window.addEventListener('resize', updateCarousel);
    }

    async function playVideo(videoId) {
        videoPlayer.src = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
        videoPlayerContainer.style.display = 'flex';
        videoPlayer.focus();
        
        const videosByCategories = await fetchAllVideos();
        let currentPlaylistVideos = [];
        for (const category in videosByCategories) {
            const videos = videosByCategories[category];
            if (videos.some(v => v.snippet.resourceId.videoId === videoId)) {
                currentPlaylistVideos = videos;
                break;
            }
        }
        
        const suggestedVideos = currentPlaylistVideos.filter(v => v.snippet.resourceId.videoId !== videoId);
        renderSuggestedVideos(suggestedVideos.slice(0, 5));
    }

    function renderSuggestedVideos(videos) {
        suggestedVideosList.innerHTML = '';
        if (videos.length === 0) {
            suggestedVideosList.innerHTML = '<p>Pas de suggestions pour le moment.</p>';
            return;
        }

        videos.forEach(item => {
            const snippet = item.snippet;
            const videoId = snippet.resourceId.videoId;
            const card = document.createElement('div');
            card.className = 'video-card home-video-card';
            card.style.width = '150px';
            card.style.height = 'auto';
            card.innerHTML = `
                <img src="${snippet.thumbnails.high.url}" alt="${snippet.title}" class="video-thumbnail" loading="lazy" />
                <div class="video-title">${snippet.title}</div>
            `;
            card.onclick = () => playVideo(videoId);
            suggestedVideosList.appendChild(card);
        });
    }

    closeBtn.onclick = () => {
        videoPlayerContainer.style.display = 'none';
        videoPlayer.src = '';
    };

    closeBtn.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
            closeBtn.click();
        }
    });

    // Événements pour les nouveaux boutons
    searchIcon.onclick = () => {
        searchContainer.style.display = searchContainer.style.display === 'none' ? 'block' : 'none';
        searchInput.focus();
    };

    searchInput.addEventListener('input', async (e) => {
        const query = e.target.value.toLowerCase();
        const videosByCategories = await fetchAllVideos();
        const allVideosArray = [].concat(...Object.values(videosByCategories));
        
        if (query.length > 2) {
            const searchResults = allVideosArray.filter(video => 
                video.snippet.title.toLowerCase().includes(query) ||
                video.snippet.description.toLowerCase().includes(query)
            );
            contentRowsContainer.innerHTML = '';
            if (searchResults.length > 0) {
                renderVideos(searchResults, `Résultats pour "${query}"`);
            } else {
                contentRowsContainer.innerHTML = '<p style="text-align: center; margin-top: 50px;">Aucun résultat trouvé.</p>';
            }
        } else {
            // Revenir à l'accueil si le champ est vide
            loadHome();
        }
    });

    userProfileIcon.onclick = (e) => {
        e.stopPropagation();
        profileMenu.style.display = profileMenu.style.display === 'none' ? 'block' : 'none';
    };

    document.addEventListener('click', (e) => {
        if (!profileMenu.contains(e.target) && e.target !== userProfileIcon) {
            profileMenu.style.display = 'none';
        }
    });

    // Fonctions de la barre de navigation inférieure
    function resetActiveNavAndCategories() {
        bottomNavItems.forEach(item => item.classList.remove('active'));
        categoriesNavButtons.forEach(btn => btn.classList.remove('active'));
    }

    homeNavBtn.addEventListener('click', (e) => {
        e.preventDefault();
        resetActiveNavAndCategories();
        homeNavBtn.classList.add('active');
        // Synchroniser avec le bouton "Accueil" du haut
        document.querySelector('.categories-nav button').classList.add('active');
        loadHome();
    });

    rankingNavBtn.addEventListener('click', (e) => {
        e.preventDefault();
        resetActiveNavAndCategories();
        rankingNavBtn.classList.add('active');
        loadCategory('Tendance');
    });

    newsNavBtn.addEventListener('click', (e) => {
        e.preventDefault();
        resetActiveNavAndCategories();
        newsNavBtn.classList.add('active');
        loadNewReleases();
    });

    downloadNavBtn.addEventListener('click', (e) => {
        e.preventDefault();
        resetActiveNavAndCategories();
        downloadNavBtn.classList.add('active');
        contentRowsContainer.innerHTML = '<p style="text-align: center; margin-top: 50px;">Bientôt disponible : Téléchargez l\'application pour regarder vos films hors ligne !</p>';
    });

    async function loadNewReleases() {
        const videosByCategories = await fetchAllVideos();
        const allVideosArray = [].concat(...Object.values(videosByCategories));
        const sortedVideos = allVideosArray.sort((a, b) => new Date(b.snippet.publishedAt) - new Date(a.snippet.publishedAt));
        
        contentRowsContainer.innerHTML = '';
        if (sortedVideos.length > 0) {
            renderVideos(sortedVideos, "Les dernières nouveautés", false);
        } else {
            contentRowsContainer.innerHTML = '<p style="text-align: center; margin-top: 50px;">Aucune nouvelle vidéo pour le moment.</p>';
        }
    }

    document.addEventListener('DOMContentLoaded', async () => {
        await setupHeroCarousel();
        await loadHome();
    });
</script>

</body>
</html>
